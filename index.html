<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>11Bç—…æˆ¿_è‡¨åºŠé€šå ±çµ±æ•´å°å¹«æ‰‹ï½œå¡«å ±~è®“æˆ‘å€‘ä¸€èµ·çœ‹åˆ°ï½œï½œ</title>
  <script src="./config.js"></script>
  <style>
    :root{
      --bg:#faf7ff;          /* æ·¡ç´«åº• */
      --card:#ffffff;        /* å¡ç‰‡åº• */
      --ink:#2f2a3b;         /* æ–‡å­—è‰² */
      --muted:#6b6280;       /* æ¬¡è¦æ–‡å­— */
      --primary:#7c5cff;     /* ä¸»è‰²ï¼ˆæº«æŸ”ç´«ï¼‰ */
      --primary-weak:#efeaff;
      --accent:#ff8bb0;      /* é»ç¶´ç²‰ */
      --ring:#e9e2ff;        /* é‚Šæ¡†/hover */
      --ok:#10b981;          /* æˆåŠŸç¶  */
      --shadow:0 10px 24px rgba(124,92,255,.12);
      --radius:18px;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,"Noto Sans TC",Arial}
    .top{
      position:sticky; top:0; z-index:10;
      background:linear-gradient(180deg,#fff8ff,rgba(255,255,255,.8));
      backdrop-filter:blur(6px);
      border-bottom:1px solid var(--ring);
    }
    .wrap{max-width:920px;margin:0 auto;padding:16px}
    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:36px;height:36px;border-radius:12px;
      background:linear-gradient(135deg,var(--primary),var(--accent));
      box-shadow:0 6px 18px rgba(255,139,176,.25);
      display:grid;place-items:center;color:#fff;font-weight:900
    }
    h1{font-size:20px;margin:0}
    .nav{margin-left:auto}
    .nav a{
      color:var(--primary); text-decoration:none; font-weight:700;
      padding:8px 12px; border-radius:12px; background:var(--primary-weak);
    }
    .card{
      background:var(--card); border-radius:var(--radius);
      box-shadow:var(--shadow); padding:18px; margin:14px 0;
      border:1px solid var(--ring);
    }
    label{display:block;font-size:14px;color:var(--muted);margin:6px 6px 6px 8px}
    input,select,textarea{
      width:100%; padding:12px 14px; border:1.2px solid var(--ring);
      border-radius:14px; font-size:16px; background:#fff; outline:none;
      transition:border .15s, box-shadow .15s;
    }
    input:focus,select:focus,textarea:focus{border-color:var(--primary); box-shadow:0 0 0 4px var(--primary-weak)}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:720px){ .row{grid-template-columns:1fr} }
    textarea{min-height:120px; resize:vertical}
    .btn{
      appearance:none; border:none; cursor:pointer; border-radius:14px;
      padding:12px 18px; font-weight:800; font-size:16px; width:100%;
      background:linear-gradient(135deg,var(--primary),#9f86ff); color:#fff;
      box-shadow:0 10px 20px rgba(124,92,255,.28); transition:transform .05s;
    }
    .btn:active{transform:translateY(1px)}
    .ok{
      display:none; margin-top:10px; padding:10px 12px; border-radius:12px;
      background:#ecfdf5; color:#065f46; border:1px solid #d1fae5;
    }
    .hint{font-size:12px;color:var(--muted);margin:4px 8px 0}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:var(--primary-weak);color:var(--primary);font-weight:700;font-size:12px;margin-left:6px}
    .footer{font-size:12px;color:var(--muted);text-align:center;margin:18px 0}
  </style>
</head>
<body>
  <div class="top">
    <div class="wrap" style="display:flex;align-items:center;gap:12px">
      <div class="logo">ğŸ©º</div>
      <div class="brand">
        <h1>è‡¨åºŠé€šå ±å°å¹«æ‰‹</h1><span class="pill">å¡«å ±</span>
      </div>
      <div class="nav"><a href="./view.html">æŸ¥é–±</a></div>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="row">
        <div>
          <label>é€šå ±æ—¥æœŸ</label>
          <input id="reportDate" type="date">
        </div>
        <div>
          <label>å…¥é™¢æ—¥</label>
          <input id="admitDate" type="date">
        </div>
      </div>

      <div class="row">
        <div>
          <label>é¡åˆ¥</label>
          <select id="category"></select>
        </div>
        <div>
          <label>å‚·å®³ç¨‹åº¦</label>
          <select id="severity"></select>
        </div>
      </div>

      <div class="row">
        <div>
          <label>ç—…æ­·è™Ÿ</label>
          <input id="chartNo" placeholder="">
        </div>
        <div>
          <label>ç—…äººå§“å</label>
          <input id="name" placeholder="">
        </div>
      </div>

      <div class="row">
        <div>
          <label>å–®ä½/åºŠè™Ÿ</label>
          <input id="bed" placeholder="2171-1">
        </div>
        <div>
          <label>ä¸»è¦å› ç´ </label>
          <select id="factor"></select>
          <div class="hint">è‹¥ä¸‹æ‹‰æœªè¼‰å…¥ï¼Œæš«ç”¨ï¼šå¥åº·å› ç´ ï¼ç’°å¢ƒå› ç´ ï¼å…¶ä»–å› ç´ </div>
        </div>
      </div>
    </div>

    <div class="card">
      <label>é€šå ±å…§å®¹</label>
      <textarea id="message" placeholder="è«‹è¼¸å…¥â€¦"></textarea>

      <label>è­·ç†æªæ–½</label>
      <textarea id="nursing" placeholder="è«‹è¼¸å…¥â€¦"></textarea>

      <label>å»ºè­°æªæ–½</label>
      <textarea id="advice" placeholder="è«‹è¼¸å…¥â€¦"></textarea>

      <button class="btn" id="sendBtn" onclick="submitForm()">é€å‡º</button>
      <div id="ok" class="ok">âœ… å·²é€å‡ºæˆåŠŸï¼Œç¨å¾Œå¯åˆ°ã€ŒæŸ¥é–±ã€é çœ‹åˆ°ç´€éŒ„ã€‚</div>
    </div>

    <div class="footer">Â© è‡¨åºŠé€šå ±å°å¹«æ‰‹</div>
  </div>

  <script>
    // å®‰å…¨æª¢æŸ¥
    if (typeof GAS_URL === 'undefined'){
      alert('æœªè¨­å®š GAS_URLï¼Œè«‹åˆ° config.js æ”¾å…¥ Apps Script çš„ /exec ç¶²å€');
    }

    // é é¢è¼‰å…¥ï¼šè¨­ä»Šæ—¥æ—¥æœŸã€è¼‰å…¥ä¸‹æ‹‰
    (function init(){
      const today = new Date().toISOString().slice(0,10);
      document.getElementById('reportDate').value = today;
      document.getElementById('admitDate').value  = today;
      loadOptions();
    })();

    <script>
  // â”€â”€ ä¸‹æ‹‰è¼‰å…¥ï¼ˆå«é è¨­å‚™æ´ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function loadOptions(){
    try{
      const res = await fetch(`${GAS_URL}?action=options`);
      if(!res.ok) throw new Error('HTTP '+res.status);
      const data = await res.json();

      const cats = (data.categories || []).filter(Boolean);
      const sevs = (data.severities || []).filter(Boolean);
      const facs = (data.factors || []).filter(Boolean);

      // å¾Œç«¯è‹¥å›ç©ºï¼Œæä¾›å‚™æ´é¸é …ï¼Œè‡³å°‘å¯ä»¥ç”¨
      fillSelect('category', cats.length ? cats : ['è·Œå€’','çµ¦è—¥','å£“ç˜¡','è£ç½®','å…¶ä»–']);
      fillSelect('severity', sevs.length ? sevs : ['ç„¡å‚·å®³','è¼•åº¦','ä¸­åº¦','é‡åº¦','æ­»äº¡']);
      fillSelect('factor',   facs.length ? facs : ['å¥åº·å› ç´ ','ç’°å¢ƒå› ç´ ','å…¶ä»–å› ç´ ']);

    }catch(err){
      console.warn('é¸å–®è¼‰å…¥å¤±æ•—ï¼š', err);
      // ç„¡æ³•é€£åˆ° GAS â†’ å…¨éƒ¨ç”¨é è¨­ï¼Œé é¢ä¾ç„¶å¯æ“ä½œ
      fillSelect('category', ['è·Œå€’','çµ¦è—¥','å£“ç˜¡','è£ç½®','å…¶ä»–']);
      fillSelect('severity', ['ç„¡å‚·å®³','è¼•åº¦','ä¸­åº¦','é‡åº¦','æ­»äº¡']);
      fillSelect('factor',   ['å¥åº·å› ç´ ','ç’°å¢ƒå› ç´ ','å…¶ä»–å› ç´ ']);
      alert('ç„¡æ³•è¼‰å…¥é¸å–®ï¼Œå·²ä½¿ç”¨é è¨­é …ç›®ã€‚è«‹ç¨å¾Œå†è©¦æˆ–æª¢æŸ¥ GAS æ¬Šé™/ç¶²å€ã€‚');
    }
  }

  function fillSelect(id, arr){
    const sel = document.getElementById(id);
    sel.innerHTML = '<option value="">è«‹é¸æ“‡</option>' +
      arr.map(v=>`<option value="${v}">${v}</option>`).join('');
  }
</script>
</body>
</html>
