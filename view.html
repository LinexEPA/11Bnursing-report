<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è‡¨åºŠé€šå ±å°å¹«æ‰‹ï½œæŸ¥é–±</title>
  <script src="./config.js"></script>
  <style>
    :root{
      --bg:#faf7ff;--card:#fff;--ink:#2f2a3b;--muted:#6b6280;
      --primary:#7c5cff;--primary-weak:#efeaff;--ring:#e9e2ff;
      --shadow:0 12px 28px rgba(124,92,255,.14);--radius:18px;
      /* æ ¹æ“šä½ çš„é é¦–ï¼‹æ§åˆ¶åˆ—é«˜åº¦ï¼Œå¿…è¦æ™‚å¯å¾®èª¿é€™å€‹æ•¸å­— */
      --stickyTop: 140px;
    }
    @media (max-width: 720px){ :root{ --stickyTop: 120px; } }

    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui,"Noto Sans TC",Arial}
    .top{position:sticky;top:0;z-index:20;background:linear-gradient(180deg,#fff8ff,rgba(255,255,255,.85));backdrop-filter:blur(6px);border-bottom:1px solid var(--ring)}
    .wrap{max-width:1200px;margin:0 auto;padding:16px}
    h1{font-size:24px;margin:0;display:flex;align-items:center;gap:10px}
    .nav{margin-left:auto}
    .nav a{color:var(--primary);text-decoration:none;font-weight:800;background:var(--primary-weak);padding:8px 12px;border-radius:12px}
    .controls{display:flex;gap:10px;align-items:center;margin:12px 0;flex-wrap:wrap}
    input,select{padding:10px 12px;border:1.2px solid var(--ring);border-radius:12px;outline:none;background:#fff}
    input:focus,select:focus{border-color:var(--primary);box-shadow:0 0 0 4px var(--primary-weak)}
    .spacer{flex:1}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;border:1px solid var(--ring)}
    table{width:100%;border-collapse:separate;border-spacing:0}
    thead th{
      position:sticky; top:var(--stickyTop); z-index:10;
      background:#f7f4ff; color:var(--muted); font-size:12px;
      text-align:left; padding:12px; border-bottom:1px solid var(--ring); white-space:nowrap;
    }
    tbody td{padding:12px;border-bottom:1px solid #f2ecff;vertical-align:top;font-size:14px;background:#fff}
    tbody tr:nth-child(odd) td{background:#fefcff}
    tbody tr:hover td{background:#fbf7ff}
  </style>
</head>
<body>
  <div class="top">
    <div class="wrap" style="display:flex;align-items:center;gap:12px">
      <h1>ğŸ“‹ è‡¨åºŠé€šå ±å°å¹«æ‰‹</h1>
      <div class="spacer"></div>
      <div class="nav"><a href="./index.html">å¡«å ±</a></div>
    </div>
  </div>

  <div class="wrap">
    <div class="controls">
      <input id="q" placeholder="æœå°‹é—œéµå­—ï¼ˆäººåã€å–®ä½ã€å…§å®¹â€¦ï¼‰" oninput="load()">
      <select id="limit" onchange="load()">
        <option value="20">æœ€è¿‘ 20 ç­†</option>
        <option value="50" selected>æœ€è¿‘ 50 ç­†</option>
        <option value="100">æœ€è¿‘ 100 ç­†</option>
      </select>
      <div class="spacer"></div>
      <a id="sheet" target="_blank" style="text-decoration:none;color:var(--primary);font-weight:800">å‰å¾€è©¦ç®—è¡¨ â†—</a>
    </div>

    <div class="card">
      <table id="tbl">
        <!-- è¡¨é ­å›ºå®šå¯«åœ¨ theadï¼šæ°¸é ç¬¬ä¸€åˆ—ï¼Œä¸æœƒè¢«è³‡æ–™å½±éŸ¿ -->
        <thead>
          <tr>
            <th>é€šå ±æ—¥æœŸ</th>
            <th>é¡åˆ¥</th>
            <th>å‚·å®³ç¨‹åº¦</th>
            <th>ç—…æ­·è™Ÿ</th>
            <th>ç—…äººå§“å</th>
            <th>å…¥é™¢æ—¥</th>
            <th>ä½é™¢å¤©æ•¸</th>
            <th>å–®ä½/åºŠè™Ÿ</th>
            <th>ä¸»è¦å› ç´ </th>
            <th>é€šå ±å…§å®¹</th>
            <th>è­·ç†æªæ–½</th>
            <th>å»ºè­°æªæ–½</th>
          </tr>
        </thead>
        <tbody></tbody> <!-- åªæŠŠè³‡æ–™å¡é€² tbody -->
      </table>
    </div>
  </div>

  <script>
    if (typeof GAS_URL==='undefined'){ alert('config.js æœªè¼‰å…¥'); }

    // æ¬„ä½å°æ‡‰ï¼ˆå›ºå®šé †åºï¼Œé¿å…è¡¨é ­èˆ‡è³‡æ–™éŒ¯ä½ï¼‰
    const COLS = [
      'é€šå ±æ—¥æœŸ','é¡åˆ¥','å‚·å®³ç¨‹åº¦','ç—…æ­·è™Ÿ','ç—…äººå§“å',
      'å…¥é™¢æ—¥','ä½é™¢å¤©æ•¸','å–®ä½/åºŠè™Ÿ','ä¸»è¦å› ç´ ',
      'é€šå ±å…§å®¹','è­·ç†æªæ–½','å»ºè­°æªæ–½'
    ];

    // å°‡ä»»ä½•æ ¼å¼çš„æ—¥æœŸ â†’ yyyy/MM/ddï¼ˆåªè¦æ—¥æœŸï¼Œä¸è¦æ™‚é–“ï¼‰
    function toDateString(v){
      if (!v) return '';
      // å¦‚æœæ˜¯ "2025-08-14T00:00:00.000Z" â†’ å…ˆå–å‰ 10 ç¢¼
      const s = String(v);
      const iso = s.length >= 10 ? s.slice(0,10) : s;
      // å…è¨± "yyyy-MM-dd" / "yyyy/MM/dd"
      const m = /^(\d{4})[-/](\d{2})[-/](\d{2})$/.exec(iso);
      if (m){
        const d = new Date(Number(m[1]), Number(m[2])-1, Number(m[3]));
        const y = d.getFullYear();
        const mm = String(d.getMonth()+1).padStart(2,'0');
        const dd = String(d.getDate()).padStart(2,'0');
        return `${y}/${mm}/${dd}`;
      }
      // å¦‚æœæ˜¯ Date ç‰©ä»¶
      const d2 = new Date(s);
      if (!isNaN(d2)) {
        const y = d2.getFullYear();
        const mm = String(d2.getMonth()+1).padStart(2,'0');
        const dd = String(d2.getDate()).padStart(2,'0');
        return `${y}/${mm}/${dd}`;
      }
      return s; // å…¶ä»–æƒ…æ³å°±åŸæ¨£å›å‚³
    }

    // æ’åºç”¨ï¼šæŠŠå­—ä¸²è½‰æˆæ™‚é–“æˆ³
    function toTime(v){
      const s = toDateString(v); // e.g. 2025/08/14
      const m = /^(\d{4})\/(\d{2})\/(\d{2})$/.exec(s);
      if (m) return new Date(Number(m[1]), Number(m[2])-1, Number(m[3])).getTime();
      const d = new Date(v); return isNaN(d)?0:d.getTime();
    }

    async function load(){
      try{
        const u = new URL(GAS_URL);
        u.searchParams.set('action','list');
        u.searchParams.set('limit', document.getElementById('limit').value);
        u.searchParams.set('query', document.getElementById('q').value.trim());
        const r = await fetch(u,{cache:'no-store'});
        const { ok, rows, sheetUrl } = await r.json();
        if(!ok) throw new Error('API å›å‚³å¤±æ•—');
        document.getElementById('sheet').href = sheetUrl;

        // å…ˆæŠŠè³‡æ–™æŒ‰ã€Œé€šå ±æ—¥æœŸã€ç”±æ–°åˆ°èˆŠæ’åºï¼ˆä¸å½±éŸ¿è¡¨é ­ï¼‰
        const sorted = (rows||[]).slice().sort((a,b)=> toTime(b['é€šå ±æ—¥æœŸ']) - toTime(a['é€šå ±æ—¥æœŸ']));

        // å¡é€² tbodyï¼ˆè¡¨é ­ä¿æŒä¸å‹•ï¼‰
        const tb = document.querySelector('#tbl tbody');
        tb.innerHTML = '';
        sorted.forEach(row=>{
          const tds = COLS.map(key=>{
            let v = row[key] ?? '';
            if (key==='é€šå ±æ—¥æœŸ' || key==='å…¥é™¢æ—¥') v = toDateString(v); // åªé¡¯ç¤ºæ—¥æœŸ
            return `<td>${v}</td>`;
          }).join('');
          tb.insertAdjacentHTML('beforeend', `<tr>${tds}</tr>`);
        });
      }catch(e){
        console.error(e);
        alert('è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ GAS_URL / æ¬Šé™');
      }
    }

    // åˆæ¬¡è¼‰å…¥
    load();
  </script>
</body>
</html>
