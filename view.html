<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>臨床通報小幫手｜查閱</title>
<script src="./config.js"></script>
<style>
  body{font-family:ui-sans-serif,"Noto Sans TC",Arial;margin:0;background:#faf7ff;color:#2f2a3b}
  .top{position:sticky;top:0;background:#fff8ff;backdrop-filter:blur(6px);border-bottom:1px solid #e9e2ff;z-index:10}
  .wrap{max-width:960px;margin:0 auto;padding:16px}
  h1{font-size:20px;margin:0}
  .nav{margin-left:auto}
  .nav a{color:#7c5cff;text-decoration:none;font-weight:800;background:#efeaff;padding:8px 12px;border-radius:12px}
  table{border-collapse:collapse;width:100%;margin-top:12px;background:white;border-radius:14px;overflow:hidden}
  th,td{padding:10px;border-bottom:1px solid #eee;text-align:left;font-size:14px}
  th{background:#f7f4ff;position:sticky;top:64px;z-index:5} /* 固定表頭 */
  tr:hover td{background:#faf5ff}
</style>
</head>
<body>
<div class="top">
  <div class="wrap" style="display:flex;align-items:center;gap:12px">
    <div style="font-size:22px">📋</div>
    <h1>臨床通報小幫手</h1>
    <div class="nav"><a href="./index.html">填報</a></div>
  </div>
</div>

<div class="wrap">
  <table id="reportTable">
    <thead>
      <tr id="tableHeader"></tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
</div>

<script>
if(typeof GAS_URL==='undefined'){alert('config.js 未載入');}

window.addEventListener('DOMContentLoaded', loadData);

async function loadData(){
  try{
    const res = await fetch(`${GAS_URL}?action=list&limit=200`, {cache:'no-store'});
    if(!res.ok) throw new Error(`HTTP ${res.status}`);
    const data = await res.json();
    if(!data.ok) throw new Error(data.error||'無法取得資料');

    const rows = data.rows || [];
    if(!rows.length){document.getElementById('tableBody').innerHTML='<tr><td>沒有資料</td></tr>';return;}

    // 取得表頭
    const headers = Object.keys(rows[0]);
    const headerRow = document.getElementById('tableHeader');
    headerRow.innerHTML = headers.map(h=>`<th>${h}</th>`).join('');

    // 依日期排序（假設第一欄是日期）
    rows.sort((a,b)=>{
      const da = new Date(a[headers[0]]);
      const db = new Date(b[headers[0]]);
      return db - da; // 新的在上
    });

    // 填入表格
    const body = document.getElementById('tableBody');
    body.innerHTML = rows.map(r=>{
      return `<tr>${headers.map(h=>`<td>${r[h]||''}</td>`).join('')}</tr>`;
    }).join('');
  }catch(err){
    console.error(err);
    alert('載入資料失敗：'+err.message);
  }
}
</script>
</body>
</html>
